# Исправление Telegram интеграции

## Проблема
При создании заказа через API не отправлялись уведомления в Telegram из-за отсутствия библиотеки `python-telegram-bot` в Docker контейнере.

## Внесенные изменения

### 1. Добавлена зависимость
- Добавлена библиотека `python-telegram-bot>=20.0` в `admin_service/requirements/requirements.txt`

### 2. Исправлен метод create_order_api
- Удалена неиспользуемая функция `send_telegram()`
- Исправлена отправка уведомлений в Telegram через `background_tasks`
- Добавлено получение полной информации о товарах из базы данных для корректного формирования сообщения

### 3. Улучшена обработка данных заказа
- Теперь для каждого товара в заказе получается полная информация из базы данных
- В случае отсутствия товара в базе используется fallback с данными из заказа

## Инструкции по развертыванию

### 1. Пересборка Docker контейнера
```bash
# Остановить текущие контейнеры
docker-compose -f docker-compose.prod.yml down

# Пересобрать контейнер admin с новыми зависимостями
docker-compose -f docker-compose.prod.yml build admin

# Запустить контейнеры
docker-compose -f docker-compose.prod.yml up -d
```

### 2. Проверка работы
```bash
# Проверить логи admin контейнера
docker-compose -f docker-compose.prod.yml logs admin

# Запустить тест Telegram интеграции
python test_telegram_fix.py
```

### 3. Тестирование API
```bash
# Тест отправки в Telegram
curl -X POST http://localhost/api/telegram/test
```

## Ожидаемый результат
После применения исправлений:
1. При создании заказа через `/api/orders` будет отправляться уведомление в Telegram
2. В логах не будет ошибок "библиотека python-telegram-bot не установлена"
3. Уведомления будут содержать полную информацию о заказе и товарах

## Переменные окружения
Убедитесь, что установлены:
- `TELEGRAM_BOT_TOKEN` - токен бота
- `TELEGRAM_CHAT_ID` - ID чата для уведомлений (по умолчанию: -1003068821769)
